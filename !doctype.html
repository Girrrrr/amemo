<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, height=device-height,
                 initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Memorandum</title>

  <style>
    /* ========= EMBEDDED FONT ========= */
    @font-face {
      font-family: 'Scrawlish';
      src: url('./Scrawlish-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #666666;
      --border: #e5e7eb;
      --btnbg: #f4f4f5;
      --header-height: 50px;
    }

    html[data-theme="dark"] {
      --bg: #0b0d12;
      --fg: #e5e7eb;
      --muted: #9ca3af;
      --border: #272b36;
      --btnbg: #1f2937;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }

    button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--btnbg);
      color: var(--fg);
      cursor: pointer;
    }
    button:hover { filter: brightness(1.1); }

    header {
      height: var(--header-height);
      display: flex;
      align-items: center;
      padding: 0 10px;
      border-bottom: 1px solid var(--border);
    }

    main {
      height: calc(100% - var(--header-height));
      display: flex;
      flex-direction: column;
    }

    #listView, #editorView {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }

    .note-item {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .note-title { font-weight: bold; }
    .note-snippet {
      font-size: 12px;
      color: var(--muted);
    }

    #editorView {
      display: none;
      flex-direction: column;
      padding-top: 0;
    }

    #toolbar {
      display: flex;
      gap: 8px;
      border-bottom: 1px solid var(--border);
      padding: 8px;
      flex-shrink: 0;
    }

    textarea {
      flex: 1;
      width: 100%;
      border: none;
      outline: none;
      resize: none;
      padding: 12px;
      box-sizing: border-box;
      background: var(--bg);
      color: var(--fg);

      /* SCRAWLISH FONT APPLIED HERE */
      font-family: 'Scrawlish', serif;
      font-size: 15pt;
      line-height: 1.6;

      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-x: hidden;
    }
  </style>

  <!-- Cordova injects this at runtime -->
  <script src="cordova.js"></script>
</head>
<body>

<header>
  <strong>Memorandum</strong>
  <span style="flex:1"></span>
  <button id="themeToggle">Noir</button>
  <button id="newNoteBtn">New</button>
</header>

<main>
  <!-- LIST VIEW -->
  <section id="listView">
    <div id="notesList"></div>
    <p id="emptyState" style="color:var(--muted);text-align:center;">
      No notes yet.
    </p>
  </section>

  <!-- EDITOR VIEW -->
  <section id="editorView">
    <div id="toolbar">
      <button id="backBtn">‚Üê</button>
      <button id="deleteBtn">Delete</button>
      <span style="flex:1"></span>
      <button id="saveBtn">Save</button>
    </div>
    <textarea id="content"></textarea>
  </section>
</main>

<script>
  const STORAGE_KEY = 'barebones_notes_v2';
  const THEME_KEY = 'barebones_theme';

  let notes = [];
  let currentId = null;

  const listView = document.getElementById('listView');
  const editorView = document.getElementById('editorView');
  const notesList = document.getElementById('notesList');
  const emptyState = document.getElementById('emptyState');
  const contentEl = document.getElementById('content');

  const newNoteBtn = document.getElementById('newNoteBtn');
  const saveBtn = document.getElementById('saveBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const backBtn = document.getElementById('backBtn');
  const themeToggle = document.getElementById('themeToggle');

  function load() {
    try {
      notes = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch {
      notes = [];
    }
  }

  function persist() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
  }

  function getTitle(txt) {
    if (!txt) return '(untitled)';
    return txt.split(/\r?\n/)[0].slice(0, 50) || '(untitled)';
  }

  function renderList() {
    notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
    notesList.innerHTML = '';
    emptyState.style.display = notes.length ? 'none' : 'block';

    for (let n of notes) {
      const div = document.createElement('div');
      div.className = 'note-item';
      div.innerHTML =
        `<div class="note-title">${getTitle(n.content)}</div>
         <div class="note-snippet">${(n.content || '').slice(0, 80)}</div>`;
      div.onclick = () => openEditor(n.id);
      notesList.appendChild(div);
    }

    showList();
  }

  function showList() {
    listView.style.display = 'block';
    editorView.style.display = 'none';
  }

  function showEditor() {
    listView.style.display = 'none';
    editorView.style.display = 'flex';
    contentEl.focus();
  }

  function createNote() {
    const n = {
      id: Date.now().toString(36) + Math.random().toString(36).slice(2),
      content: '',
      updatedAt: new Date().toISOString()
    };
    notes.unshift(n);
    persist();
    openEditor(n.id);
  }

  function openEditor(id) {
    const n = notes.find(x => x.id === id);
    if (!n) return;
    currentId = id;
    contentEl.value = n.content;
    showEditor();
  }

  function saveCurrent() {
    if (!currentId) return;
    const n = notes.find(x => x.id === currentId);
    if (!n) return;
    n.content = contentEl.value;
    n.updatedAt = new Date().toISOString();
    persist();
  }

  function deleteCurrent() {
    if (!currentId) return;
    notes = notes.filter(x => x.id !== currentId);
    persist();
    renderList();
  }

  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);
  }

  function initTheme() {
    const saved = localStorage.getItem(THEME_KEY);
    if (saved) applyTheme(saved);
    else applyTheme(
      window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    );
  }

  /* EVENTS */
  newNoteBtn.onclick = createNote;
  saveBtn.onclick = () => { saveCurrent(); alert('Saved'); };
  deleteBtn.onclick = () => { if (confirm('Delete this note?')) deleteCurrent(); };
  backBtn.onclick = () => { saveCurrent(); renderList(); };
  themeToggle.onclick = () =>
    applyTheme(document.documentElement.getAttribute('data-theme') === 'dark'
      ? 'light' : 'dark');
  contentEl.oninput = saveCurrent;

  /* INIT */
  load();
  initTheme();
  renderList();
</script>

</body>
</html>
